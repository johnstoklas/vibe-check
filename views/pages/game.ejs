<!DOCTYPE html>
<html>
  <script>

    const socket = new WebSocket("ws://localhost:8080/game");

    socket.addEventListener("open", () => {
      console.log("Connection established");
    });

    let selectedCharIndex = null;
    let selectedActionIndex = null;

    socket.addEventListener("message", (event) => {
    const data = JSON.parse(event.data);

    console.log("Received actions:", data);

    if (data.type === "update") {

      document.getElementById("score").textContent = `Score: ${data.gameState.score}`;
      document.getElementById("money").textContent = `Money: $${data.gameState.money}`;

      // ðŸ‘‡ NEW: Update the character-choice buttons
      if (data.actions) {
        const buttons = document.querySelectorAll("#character-button-container button");

        buttons.forEach((btn, i) => {
          if (data.actions[i]) {
            btn.textContent = data.actions[i].name;
            btn.style.display = 'block';
            btn.onclick = () => chooseAction(i); // ðŸ‘ˆ this sets the click behavior
          } else {
            btn.style.display = 'none';
            btn.onclick = null;
          }
        });
      }
    }
});


  function selectCharacter(index) {
    const partial = document.getElementById('character-choice-container');
      if(partial)
        partial.style.display = 'flex';

    selectedCharIndex = index;
    socket.send(JSON.stringify({ type: "character_selection", char_index: index }));
  }

  function ignoreCharacter() {
      const partial = document.getElementById('character-choice-container');
      if(partial) {
          partial.style.display = 'none';
      }
    }   

  function chooseAction(index) {
    selectedActionIndex = index;
    socket.send(JSON.stringify({ type: "action_selection", action_index: index }));
  }
  </script>
  <body>
    <%-include('../partials/character_choice.ejs')%>
    <div id="header-container"> 
      <button>Home</button>
      <div id="score-container">
        <div id="score">Score: 0</div> 
        <div id="money">Money: $0</div>
      </div>
    </div>
    <div id="all-characters-container"> 
      <div class="character-container">
        <div class="character-image-container" onclick="selectCharacter(0)"></div>
        <div class="character-score-container"></div>
      </div>
      <div class="character-container">
        <div class="character-image-container" onclick="selectCharacter(1)"></div>
        <div class="character-score-container"></div>
      </div>
      <div class="character-container">
        <div class="character-image-container" onclick="selectCharacter(2)"></div>
        <div class="character-score-container"></div>
      </div>
      <div class="character-container">
        <div class="character-image-container" onclick="selectCharacter(3)"></div>
        <div class="character-score-container"></div>
      </div>
      <div class="character-container">
        <div class="character-image-container" onclick="selectCharacter(4)"></div>
        <div class="character-score-container"></div>
      </div>
    </div>
  </body>  
  <style>
    #header-container {
      display: flex;
      flex-direction: row;
      gap: 50px;
    }
    #score-container {
      display: flex;
      flex-direction: row;
      gap: 20px;
    }
    #all-characters-container {
      display: flex;
      flex-direction: row;
      gap: 10px;
      justify-content: center;
      margin-top: 140px;         
    }
    .character-container {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .character-image-container {
      height: 200px;
      width: 200px;
      border: 1px solid black;
    }
    .character-score-container {
      width: 200px;
      height: 40px;
      border: 1px solid black;
    }
    #character-choice-container {
      flex-direction: column;
      display: none;
      height: 400px;
      width: 200px;
      border: 1px solid black;
      position: absolute;
      top: 50%;
      left: 50%;
      margin-left: -100px;
      margin-top: -200px;
      background-color: lightblue;
      align-items: center;
    }
    #character-choice-container h4 {
      margin-bottom: 40px;
    }
    #character-button-container {
      display: flex;
      flex-direction: column;
      margin-bottom: 40px;
      gap: 10px;
    }
  </style>
</html>